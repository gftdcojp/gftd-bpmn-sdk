<!-- 547ae800-b97f-40c5-a98f-db704ce78cd6 c4dd327d-4769-4a14-9c21-5a57851691b1 -->
# form-js TypeScript パッケージ追加計画

### 目的

- `@bpmn-io/form-js` の Viewer/Editor/Playground を TypeScript から安全に利用できるラッパーを提供。
- フォームスキーマの型・検証、`getSchemaVariables` の型安全版を提供。
- SSRガード（Next.js/RSC環境で安全）と JSDOM によるテスト整備。
- 既存 README の思想・品質ゲート（Effect Schema, Vitest, Biome, Typedoc）に整合。

参考: 公式API/用法 [bpmn-io/form-js](https://github.com/bpmn-io/form-js/tree/develop)

### 追加パッケージ構成

- `packages/form/`
  - `package.json` name:`@gftd/bpmn-sdk/form`, deps:`@bpmn-io/form-js`, `@effect/schema`
  - `src/index.ts`（公開エントリ）
  - `src/types.ts`（`FormSchema`, `FormData`, `FormOptions` 型＋Effect Schema）
  - `src/viewer.ts`（`createForm` ラッパー）
  - `src/editor.ts`（`createFormEditor` ラッパー）
  - `src/playground.ts`（`createFormPlayground` ラッパー）
  - `src/utils/getSchemaVariables.ts`（型安全版）
  - `src/ssr.ts`（`assertClient()` SSR ガード）
  - `src/__tests__/...`（JSDOM での最小E2E/ユニット）
  - `tsconfig.json`（strict, noEmit false）

### 主要API（抜粋）

- 型
  - `FormSchema`, `FormData`, `FormOptions`（Effect Schema で runtime validate）
- Viewer
  - `createForm({ container, schema, data?, options? }): Promise<FormHandle>`
  - `FormHandle = { update(data), importSchema(schema, data?), onSubmit(cb), destroy() }`
- Editor
  - `createFormEditor({ container, schema, options? }): Promise<FormEditorHandle>`
- Playground
  - `createFormPlayground({ container, schema, data?, options? }): Promise<FormPlaygroundHandle>`
- Utils
  - `getSchemaVariables(schema, opts?): { inputs: string[]; outputs: string[] }`

### SSRガード（必須）

```ts
export function assertClient(): void {
  if (typeof window === "undefined" || typeof document === "undefined") {
    throw new Error("form-js requires a browser environment");
  }
}
```

- 各 `create*` で最初に実行。

### テスト

- Vitest + JSDOM（watch: false）
- 最低限の動作確認：importSchema→submit ハンドラ→destroy のライフサイクル
- 型テスト：Effect Schema の parse 成否

### ドキュメント/例

- ルート `README.md` に「Forms」セクション追加（使用例・SSR注意点）
- `examples/form-js-minimal/` を追加し、Viewer/Editor/Playground の最小例を提供
- Typedoc 対象に `packages/form` を追加

### Monorepo 統合

- `pnpm-workspace.yaml` に `packages/form` が含まれることを確認
- `turbo.json` に build/test/lint パイプラインを追加
- `vitest.config.ts` に JSDOM プロジェクト設定を追加（必要なら）

### 実装上の注意

- React ラッパーは提供しない（禁止ルールの `useEffect/useMemo` 回避）。必要時は別途相談。
- `node:crypto` 非使用を確認。
- 1ファイル < 1000 行; インタフェース/実装/ユーティリティを分割。
- ラッパーは例外を Result 風の戻りにせず、`create*` で明示例外→境界で捕捉（READMEの方針に整合）。

### To-dos

- [ ] packages/form を作成し package.json/tsconfig を定義
- [ ] FormSchema/FormData/FormOptions を型+Effect Schemaで定義
- [ ] createForm と FormHandle を実装（SSRガード含む）
- [ ] createFormEditor と EditorHandle を実装
- [ ] createFormPlayground と Handle を実装
- [ ] getSchemaVariables の型安全版を実装
- [ ] JSDOM でユニット/E2E 最小テスト追加
- [ ] examples/form-js-minimal を追加
- [ ] README に Forms セクションと使用例を追加
- [ ] pnpm-workspace/turbo/typedoc/vitest 設定へ統合